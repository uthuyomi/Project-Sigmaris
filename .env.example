# Backend (FastAPI / persona_core)

# OpenAI
OPENAI_API_KEY=
SIGMARIS_PERSONA_MODEL=gpt-4.1
SIGMARIS_EMBEDDING_MODEL=text-embedding-3-small

# Debug / tracing
SIGMARIS_TRACE=1
SIGMARIS_TRACE_TEXT=0
# If set to 1, backend raises LLM errors (useful for debugging)
SIGMARIS_RAISE_LLM_ERRORS=0

# Supabase (optional: enable backend persistence via PostgREST)
SUPABASE_URL=
SUPABASE_SERVICE_ROLE_KEY=
SUPABASE_ANON_KEY=
SUPABASE_SCHEMA=public

# OAuth provider credentials (REFERENCE ONLY)
# - Social login credentials are configured in the Supabase Dashboard (Auth -> Providers).
# - These env vars are NOT used by the backend directly.
OAUTH_GOOGLE_CLIENT_ID=
OAUTH_GOOGLE_CLIENT_SECRET=
OAUTH_GITHUB_CLIENT_ID=
OAUTH_GITHUB_CLIENT_SECRET=
OAUTH_DISCORD_CLIENT_ID=
OAUTH_DISCORD_CLIENT_SECRET=

# Public deployment defaults
# - If Supabase is configured, auth is required by default.
SIGMARIS_REQUIRE_AUTH=1
# Comma-separated origins (e.g. https://your-ui.vercel.app,http://localhost:3000)
SIGMARIS_CORS_ORIGINS=

# Phase04: attachments / storage
SIGMARIS_STORAGE_BUCKET=sigmaris-attachments
SIGMARIS_UPLOAD_MAX_BYTES=5242880

# Phase04: enable kernel application (approved deltas -> snapshot/apply/rollback + DB persist)
SIGMARIS_PHASE04_KERNEL_APPLY=0
# Snapshot after apply (replay-friendly). Recommended ON for practical ops.
SIGMARIS_KERNEL_SNAPSHOT_AFTER=1

# Phase04: External I/O audit + cache (optional but recommended for stable operations)
# - If enabled and Supabase is configured, /io/* endpoints will write replay-friendly I/O logs to `common_io_events`.
# - Cache returns recent identical responses to reduce cost/rate-limit issues and improve reproducibility.
SIGMARIS_IO_CACHE_ENABLED=1
SIGMARIS_IO_CACHE_TTL_SEC=3600
# Limit how much excerpt text is stored in DB for audits (0 disables excerpt storage).
SIGMARIS_IO_AUDIT_STORE_EXCERPT_CHARS=2000

# Phase04: external I/O providers (optional)
SERPER_API_KEY=
GITHUB_TOKEN=

# Phase04: web fetch (optional; allows deeper URL analysis)
# Security: set allowlist for public deployments (prevents SSRF / abuse)
# SIGMARIS_WEB_FETCH_ALLOW_DOMAINS=nhk.or.jp,nikkei.com,asahi.com,yomiuri.co.jp
# SIGMARIS_WEB_FETCH_ALLOW_ALL=0
# (Local dev shortcut) Allow any public host (still blocks private/loopback). DO NOT enable on public deployments.
# SIGMARIS_WEB_FETCH_ALLOW_ALL=1
# SIGMARIS_WEB_FETCH_TIMEOUT_SEC=20
# SIGMARIS_WEB_FETCH_MAX_BYTES=1500000
# SIGMARIS_WEB_FETCH_USER_AGENT=sigmaris-core-web-fetch/1.0
# Summarization (uses OpenAI; paraphrase only)
# SIGMARIS_WEB_FETCH_SUMMARIZE=1
# SIGMARIS_WEB_FETCH_SUMMARY_MODEL=gpt-4o-mini
# SIGMARIS_WEB_FETCH_SUMMARY_TIMEOUT_SEC=60

# Phase04: natural-language auto browse (UI server routes)
# - When user asks to "search/news/source" without URLs, UI auto-calls /io/web/search and (optionally) /io/web/fetch.
# - Set to 0 to disable.
SIGMARIS_AUTO_BROWSE_ENABLED=1
SIGMARIS_AUTO_BROWSE_MAX_RESULTS=5
SIGMARIS_AUTO_BROWSE_FETCH_TOP=2
# Optional: comma-separated domains used when auto-browse detects "news/article" intent.
# SIGMARIS_AUTO_BROWSE_NEWS_DOMAINS=nhk.or.jp,nikkei.com,asahi.com,yomiuri.co.jp,mainichi.jp,jiji.com,kyodonews.jp,itmedia.co.jp,impress.co.jp,reuters.com
